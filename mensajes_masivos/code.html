<div class="ia-messaging-container" style="padding: 20px; background: #111827; border-radius: 12px; border: 1px solid #1f2937;">
    <h2 style="color: white; margin-bottom: 15px;">üöÄ Soporte de Env√≠os Masivos</h2>
    
    <div style="margin-bottom: 20px;">
        <label style="color: #9ca3af; display: block; margin-bottom: 8px;">N√∫meros de destino (separados por comas)</label>
        <textarea id="phone_list" placeholder="Ej: 54911223344, 54911556677..." 
                  style="width: 100%; height: 120px; background: #1f2937; color: white; border: 1px solid #374151; border-radius: 8px; padding: 10px;"></textarea>
    </div>

    <div style="margin-bottom: 20px;">
        <label style="color: #9ca3af; display: block; margin-bottom: 8px;">Mensaje de la Campa√±a</label>
        <textarea id="campaign_message" placeholder="Escribe tu mensaje aqu√≠..." 
                  style="width: 100%; height: 80px; background: #1f2937; color: white; border: 1px solid #374151; border-radius: 8px; padding: 10px;"></textarea>
    </div>

    <div style="display: flex; gap: 10px;">
        <button id="btn_analyze" style="background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
            Consultar Soporte IA (Frecuencia y Horarios)
        </button>
        <button id="btn_send" style="background: #059669; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
            Iniciar Env√≠o Programado
        </button>
    </div>

    <div id="ai_strategy_report" style="margin-top: 20px; padding: 15px; background: rgba(37, 99, 235, 0.1); border-left: 4px solid #2563eb; display: none;">
        <h4 style="color: #60a5fa; margin: 0 0 10px 0;">Estrategia Sugerida por Gemini:</h4>
        <p id="strategy_text" style="color: white; font-size: 14px; white-space: pre-wrap;"></p>
        <small style="color: #9ca3af;">Resumen enviado a: woowestudio45@gmail.com</small>
    </div>
</div>
<script type="module">
    import { geminiService } from '../../services/geminiService.ts';

    const btnAnalyze = document.getElementById('btn_analyze');
    const phoneList = document.getElementById('phone_list');
    const campaignMsg = document.getElementById('campaign_message');
    const aiReport = document.getElementById('ai_strategy_report');
    const strategyText = document.getElementById('strategy_text');

    btnAnalyze.onclick = async () => {
        if (!phoneList.value || !campaignMsg.value) {
            alert("Por favor, ingresa los n√∫meros y el mensaje primero.");
            return;
        }

        btnAnalyze.innerText = "Analizando estrategia...";
        btnAnalyze.disabled = true;

        try {
            // Llamamos a la funci√≥n que creamos antes en geminiService
            const respuesta = await geminiService.analizarEstrategiaEnvio(
                phoneList.value, 
                campaignMsg.value
            );

            strategyText.innerText = respuesta;
            aiReport.style.display = 'block';
        } catch (error) {
            alert("Error al conectar con la IA. Verifica tu API KEY.");
        } finally {
            btnAnalyze.innerText = "Consultar Soporte IA (Frecuencia y Horarios)";
            btnAnalyze.disabled = false;
        }
    };
</script>
